---
import "../styles/global.css";

// Helper for SSR
function getBaseUrl(Astro) {
  if (Astro.site) return Astro.site;
  if (Astro.request) return new URL(Astro.request.url).origin;
  return "https://astro-blog-starter-template.mtndatasales.workers.dev"; // fallback for prod
}

// Fetch 30-day USD/NGN history
let history = [];
try {
  const baseUrl = getBaseUrl(Astro);
  const res = await fetch(`${baseUrl}/api/usd-ngn-history`);
  if (res.ok) {
    history = await res.json();
  }
} catch (e) {
  history = [];
}

// Calculate 30d high/low
let buyHigh = Math.max(...history.map(h => h.buy ?? 0));
let buyLow = Math.min(...history.map(h => h.buy ?? Infinity));
let sellHigh = Math.max(...history.map(h => h.sell ?? 0));
let sellLow = Math.min(...history.map(h => h.sell ?? Infinity));

// Get the last 7 days for table
let last7 = history.slice(-7).reverse(); // newest first
---

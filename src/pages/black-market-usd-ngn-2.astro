---
import "../styles/global.css";

// Helper: Always get the absolute API endpoint
function getBaseUrl(Astro) {
  if (Astro.site) return Astro.site;
  if (Astro.request) return new URL(Astro.request.url).origin;
  return "https://astro-blog-starter-template.mtndatasales.workers.dev";
}

// Fetch latest rates for USD/NGN (summary box)
let latest = {};
try {
  const res = await fetch(`${getBaseUrl(Astro)}/api/latest-rates`);
  if (res.ok) {
    const allRates = await res.json();
    latest = allRates["USD_NGN"] ?? {};
  }
} catch {
  latest = {};
}

// Formatting
function formatDate(dt = new Date()) {
  return dt.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
}
const todayDate = new Date();
const sellRate = typeof latest.sell === "number" ? latest.sell : 'N/A'; // SELL: public is buying USD, so API "sell"
const buyRate = typeof latest.buy === "number" ? latest.buy : 'N/A';   // BUY: public is selling USD, so API "buy"
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>USD to NGN Black Market Rate</title>
    <meta name="description" content="Live USD to Naira black market rate" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <section>
      <p>
        As of {formatDate(todayDate)}, the exchange rate for 1 US Dollar to Nigerian Naira is <b>₦{sellRate}</b>.
      </p>
      <p>
        If you're planning to buy 1 Dollar at street value, the current rate would cost you approximately <b>₦{sellRate}</b>.
      </p>
      <p>
        Do you have 1 Dollar to sell now? Here is the rate to sell: <b>₦{buyRate}</b> for USD.
      </p>
    </section>
  </body>
</html>

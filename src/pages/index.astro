---
import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const todayDate = new Date().toLocaleDateString("en-GB", { day: "numeric", month: "long", year: "numeric" });

const cityList = "Lagos, Abuja, Portharcourt, and Kano";

const currencies = [
  { code: "USD_NGN", label: "Dollar", flag: "ðŸ‡ºðŸ‡¸", name: "USD", url: "/black-market-usd-ngn-2" },
  { code: "GBP_NGN", label: "Pound", flag: "ðŸ‡¬ðŸ‡§", name: "GBP", url: "/black-market-gbp-ngn-2" },
  { code: "EUR_NGN", label: "Euro", flag: "ðŸ‡ªðŸ‡º", name: "EUR", url: "/black-market-eur-ngn-2" },
  { code: "CAD_NGN", label: "Canadian Dollar", flag: "ðŸ‡¨ðŸ‡¦", name: "CAD", url: "/black-market-cad-ngn-2" },
  { code: "ZAR_NGN", label: "Rand", flag: "ðŸ‡¿ðŸ‡¦", name: "ZAR", url: "/black-market-zar-ngn-2" },
  { code: "AUD_NGN", label: "Aussie", flag: "ðŸ‡¦ðŸ‡º", name: "AUD", url: "/black-market-aud-ngn-2" },
  { code: "AED_NGN", label: "Dirham", flag: "ðŸ‡¦ðŸ‡ª", name: "AED", url: "/black-market-aed-ngn-2" },
  { code: "CNY_NGN", label: "Yuan", flag: "ðŸ‡¨ðŸ‡³", name: "CNY", url: "/black-market-cny-ngn-2" },
  { code: "GHS_NGN", label: "Cedi", flag: "ðŸ‡¬ðŸ‡­", name: "GHS", url: "/black-market-ghs-ngn-2" },
  { code: "XOF_NGN", label: "XOF", flag: "ðŸŒ", name: "XOF", url: "/black-market-xof-ngn-2" },
  { code: "XAF_NGN", label: "XAF", flag: "ðŸŒ", name: "XAF", url: "/black-market-xaf-ngn-2" },
];

let rates = {};
let usdHistory = [];
try {
  const res = await fetch("https://astro-blog-starter-template.mtndatasales.workers.dev/api/latest-rates");
  rates = await res.json();
} catch (e) {
  rates = {};
}
try {
  const res = await fetch("https://astro-blog-starter-template.mtndatasales.workers.dev/api/usd-ngn-history");
  if (res.ok) {
    usdHistory = await res.json();
  }
} catch (e) {
  usdHistory = [];
}

const todaySell = rates.USD_NGN?.sell ?? "N/A";
const todayBuy = rates.USD_NGN?.buy ?? "N/A";
const yesterdaySell = usdHistory.length > 1 && typeof usdHistory.at(-2)?.sell === "number"
  ? usdHistory.at(-2).sell
  : "N/A";
const percentChange =
  yesterdaySell !== "N/A" && todaySell !== "N/A" && typeof todaySell === "number" && typeof yesterdaySell === "number"
    ? (((todaySell - yesterdaySell) / yesterdaySell) * 100).toFixed(2)
    : "N/A";
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nairatoday - Dollar, Pound, Euro, and more to Naira Black Market Exchange Rate Today</title>
    <meta name="description" content="Track naira black market exchange rate: Dollar, Euro, Pound, and more to Naira. Live rates, daily updates." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/styles/global.css">
  </head>
  <body>
    <Header />

    <!-- Summary always at the top for SEO -->
    <div class="daily-summary" style="margin:1.5em auto 2em auto;max-width:750px;padding:1em 1.2em 1em 1.2em;background:#fff5e6;color:#283b2e;border-radius:10px;font-size:1.08em;">
      <b>{todayDate}</b>, the Naira to Dollar Black market (Abokifx) exchange rate is
      <b>{todaySell !== "N/A" ? todaySell : "N/A"}</b> in {cityList}.
      This suggests that you can now buy at just <b>{todaySell !== "N/A" ? todaySell : "N/A"}</b>
      and sell for <b>{todayBuy !== "N/A" ? todayBuy : "N/A"}</b>.<br>
      Yesterday it sold for <b>{yesterdaySell !== "N/A" ? yesterdaySell : "N/A"}</b>,
      which is just <b>{percentChange !== "N/A" ? percentChange + "%" : "N/A"}</b> of today's rate.
    </div>

    <h1 class="main-heading visually-hidden">
      Dollar, Pound, Euro, and more to Naira Black Market Exchange Rate {todayDate}
    </h1>

    <div class="cards">
      {currencies.map(({ code, label, flag, name, url }, i) => (
        <>
          <div class="card" key={code}>
            <div class="flag">{flag}</div>
            <div class="label">{label} ({name})</div>
            <a href={url} class="rate-row-link">
              <div class="rate-row"><b>BUY</b> = â‚¦{rates[code]?.buy ?? 'N/A'}</div>
              <div class="rate-row"><b>SELL</b> = â‚¦{rates[code]?.sell ?? 'N/A'}</div>
            </a>
            <div style="margin-top:12px;">
              <a href={url} class="to-naira-btn">
                {label} To Naira <span aria-hidden="true" style="font-size:1.1em;">âž”</span>
              </a>
            </div>
          </div>
          {/* Immediately after the Dollar card, insert your SEO-rich content block */}
          {i === 0 && (
            <section style="max-width:740px;margin:2em auto 1.3em auto;padding:1.3em 1.2em;background:#fff;border-radius:12px;">
              <h2>Dollar to Naira Black Market Rate Today<br/>
              How much is Dollar to Naira Today in Black Market</h2>
              <p>
                The Dollar to Naira Black Market rate remains unpredictable as it continues to remain volatile. As a Nigerian who is either involved in payment of school fees abroad or just wants to ship in items from overseas, you have to note that black market or Abokifx rate, officially known as the parallel market rate, often reflects real-time demand and supply on the go. Hence, the market is inherently volatile and most often, movements are against the Naira.
              </p>
              <h2>Dollar to Naira Black Market Buying Rate</h2>
              <p>
                Today's Dollar to Naira Black Market exchange rate traded at <b>â‚¦{todaySell !== "N/A" ? todaySell : "N/A"}</b> per $1. This simply means that one Dollar now sells for just <b>{todaySell !== "N/A" ? todaySell : "N/A"}</b>.
              </p>
            </section>
          )}
        </>
      ))}
    </div>
    <div class="welcome-box">
      <h2>Welcome to Nairatoday.com</h2>
      <p>Your trusted source for real-time updates on the Dollar to Naira Black Market exchange rate. We provide accurate, up-to-date information to help you stay informed and make smarter financial decisions.</p>
    </div>
    <Footer />
  </body>
</html>

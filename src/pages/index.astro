---
export const prerender = false;
import '../styles/global.css';

let error = null;
let rates = {};

const currencies = [
  { code: "USD_NGN", label: "Dollar", flag: "🇺🇸", name: "USD" },
  { code: "GBP_NGN", label: "Pound", flag: "🇬🇧", name: "GBP" },
  { code: "EUR_NGN", label: "Euro", flag: "🇪🇺", name: "EUR" },
  { code: "CAD_NGN", label: "Canadian Dollar", flag: "🇨🇦", name: "CAD" },
  { code: "ZAR_NGN", label: "Rand", flag: "🇿🇦", name: "ZAR" },
  { code: "AUD_NGN", label: "Aussie", flag: "🇦🇺", name: "AUD" },
  { code: "AED_NGN", label: "Dirham", flag: "🇦🇪", name: "AED" },
  { code: "CNY_NGN", label: "Yuan", flag: "🇨🇳", name: "CNY" },
  { code: "GHS_NGN", label: "Cedi", flag: "🇬🇭", name: "GHS" },
  { code: "XOF_NGN", label: "XOF", flag: "🌍", name: "XOF" },
  { code: "XAF_NGN", label: "XAF", flag: "🌍", name: "XAF" }
];

try {
  const kv = Astro.locals.runtime.env.CURRENCY_KV_ASTRO;
  if (!kv) {
    error = "KV binding not found!";
  } else {
    for (const { code } of currencies) {
      rates[code] = await kv.get(`${code}_TODAY`, "json");
    }
  }
} catch (e) {
  error = e instanceof Error ? e.message : String(e);
}
<div class="cards">
  {currencies.map(({ code, label, flag, name }) => (
    <div class="card" key={code}>
      <div class="flag">{flag}</div>
      <div class="label">{label} ({name})</div>
      <div class="rate-row"><b>BUY</b> = ₦{rates[code]?.buy ?? 'N/A'}</div>
      <div class="rate-row"><b>SELL</b> = ₦{rates[code]?.sell ?? 'N/A'}</div>
    </div>
  ))}
</div>

